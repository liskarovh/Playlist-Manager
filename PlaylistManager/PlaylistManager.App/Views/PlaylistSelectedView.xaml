<?xml version="1.0" encoding="utf-8" ?>
<views:ContentPageBase xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                       xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                       xmlns:views="clr-namespace:PlaylistManager.App.Views"
                       xmlns:viewmodels="clr-namespace:PlaylistManager.App.ViewModels"
                       xmlns:models="clr-namespace:PlaylistManager.BL.Models;assembly=PlaylistManager.BL"
                       x:Class="PlaylistManager.App.Views.PlaylistSelectedView"
                       x:DataType="viewmodels:PlaylistSelectedViewModel"
                       x:Name="PlaylistSelectedViewRoot">

    <Grid RowDefinitions="Auto, Auto, *, Auto"
          ColumnDefinitions="400, *">

        <!-- Top Bar left -->
        <Grid Grid.Column="0" ColumnDefinitions="Auto, Auto, *" HorizontalOptions="Fill" Margin="10,5">
            <ImageButton Source="setting.png"
                         Margin="10,0"
                         WidthRequest="40"
                         HeightRequest="40"
                         HorizontalOptions="Fill"
                         VerticalOptions="Fill"/>
            <Picker Grid.Column="1"
                    Title="Sort plalylists by"
                    Margin="10,0"
                    ItemsSource="{Binding PlaylistSortOptions}"
                    SelectedItem="{Binding SelectedPlaylistSortOption}" />
            <Button Grid.Column="2"
                    Text="New palylist"
                    HorizontalOptions="Fill"
                    Command="{Binding CreatePlaylistCommand}"/>
        </Grid>

        <!-- Top Bar right -->
        <Grid Grid.Column="1" ColumnDefinitions="*, Auto, Auto, Auto, 50">
            <Border Grid.Column="0"
                MinimumWidthRequest="40"
                BackgroundColor="#f2f2f2"
                Stroke="Black"
                StrokeThickness="1"
                HeightRequest="45"
                VerticalOptions="Center"
                StrokeShape="RoundRectangle 20">
                <SearchBar Placeholder="Search media in playlist"
                           BackgroundColor="Transparent"
                           FontSize="14"
                           Margin="10,0"
                           Text="{Binding MediaSearchQuery}"/>
            </Border>
            <Button Grid.Column="1"
                    Text="New Medium"
                    HorizontalOptions="Fill"
                    Margin="10,5"
                    Command="{Binding CreateMediumCommand}"/>
            <Picker Grid.Column="2"
                    Title="Sort mediums by"
                    Margin="10, 5"
                    ItemsSource="{Binding MediaSortOptions}"
                    SelectedItem="{Binding SelectedMediaSortOption}"/>
            <Picker Grid.Column="3" Title="Filter mediums by" Margin="10, 5"/>
            <Image Grid.Column="4" Source="logo.png" HorizontalOptions="Fill" VerticalOptions="Fill"/>
        </Grid>

        <!-- Second Bar -->
        <Border Grid.Row="1" Grid.ColumnSpan="2"  Stroke="Black"/>

        <!-- Second Bar left -->
        <Border Grid.Row="1" BackgroundColor="#f2f2f2" HorizontalOptions="Fill" Margin="10, 5"
                Stroke="Black"
                StrokeThickness="1"
                HeightRequest="45"
                VerticalOptions="Center"
                StrokeShape="RoundRectangle 20">
            <SearchBar Placeholder="Search playlists"
                       BackgroundColor="Transparent"
                       FontSize="14"
                       Margin="10,0"
                       Text="{Binding PlaylistSearchQuery}"/>
        </Border>

        <!-- Second Bar right -->
        <Grid Grid.Row="1" Grid.Column="1" ColumnDefinitions="3*, 2*, *, 60" Margin="10,5">
            <Label Grid.Column="0" Text="Medium name" FontSize="18" HorizontalTextAlignment="Center" VerticalTextAlignment="End"/>
            <Label Grid.Column="1" Text="Author" FontSize="18" HorizontalTextAlignment="Center" VerticalTextAlignment="End"/>
            <Label Grid.Column="2" Text="Duration" FontSize="18" HorizontalTextAlignment="Center" VerticalTextAlignment="End"/>
            <Button Grid.Column="3"
                    Text="{Binding PlaylistSortOrder}"
                    Command="{Binding TogglePlaylistSortOrderCommand}"/>
        </Grid>


        <!-- List of playlists (left) -->
        <CollectionView Grid.Row="2" Grid.Column="0"
                        ItemsSource="{Binding Playlists}"
                        SelectionMode="Single"
                        SelectionChangedCommand="{Binding SelectPlaylistCommand}"
                        SelectionChangedCommandParameter="{Binding SelectedItem, Source={RelativeSource Self}}">
            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical" HorizontalItemSpacing="10" VerticalItemSpacing="10"/>
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:PlaylistSummaryModel">
                    <Border Stroke="Black" HeightRequest="50">
                        <Grid ColumnDefinitions="*, Auto">
                            <Label Text="{Binding Title}" VerticalOptions="Center" Margin="10,0"/>
                            <ImageButton Grid.Column="1"
                                         Source="delete.png"
                                         Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:PlaylistSelectedViewModel}}, Path=DeletePlaylistCommand}"
                                         CommandParameter="{Binding PlaylistId}"/>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- List of media (right) -->
        <CollectionView Grid.Row="2" Grid.Column="1"
                        ItemsSource="{Binding Media}"
                        SelectionMode="Single"
                        SelectionChangedCommand="{Binding SelectMediumCommand}"
                        SelectionChangedCommandParameter="{Binding SelectedItem, Source={RelativeSource Self}}">
            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical" HorizontalItemSpacing="10" VerticalItemSpacing="10"/>
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:MediumSummaryModel">
                    <Border Stroke="Black" HeightRequest="50">
                        <Grid ColumnDefinitions="3*, 2*, *, 60">
                            <Label Grid.Column="0" Text="{Binding Title}" FontSize="18" VerticalOptions="Center" Margin="10,0"/>
                            <Label Grid.Column="1" Text="{Binding Author}" FontSize="18" VerticalOptions="Center"/>
                            <Label Grid.Column="2" Text="{Binding Duration, StringFormat='{0:F2} min'}" FontSize="14" VerticalOptions="Center"/>
                            <ImageButton Grid.Column="3"
                                         Source="delete.png"
                                         Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:PlaylistSelectedViewModel}}, Path=DeleteMediumCommand}"
                                         CommandParameter="{Binding .}"/>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Back button -->
        <Button Grid.Row="3"
                Text="Go back to select screen"
                HorizontalOptions="Fill"
                Command="{Binding GoBackCommand}"/>
    </Grid>
</views:ContentPageBase>
